<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Indovina l'artista del giorno</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        input, button { font-size: 1em; margin: 0.5em 0; }
        .feedback { margin-top: 1em; }
    </style>
</head>
<body>

<h2>Indovina l'artista del giorno!</h2>
<label for="nome">Nome artista:</label><br>
<input type="text" id="nome" placeholder="Inserisci il nome"><br>
<button id="prova-btn">Prova</button>

<div class="feedback" id="feedback"></div>

<py-script>
import random

# JSON degli artisti (puoi sostituirlo con il tuo Artisti.json completo)
artisti = [
    {"nome": "Laura Pausini", "debutto": 1993, "genere": "Pop", "regione": "Italia", "gender": "F"},
    {"nome": "Vasco Rossi", "debutto": 1977, "genere": "Rock", "regione": "Italia", "gender": "M"},
    {"nome": "Eros Ramazzotti", "debutto": 1984, "genere": "Pop", "regione": "Italia", "gender": "M"}
]

# Seleziona artista del giorno
artista_corrente = random.choice(artisti)
tentativi = 0
max_tentativi = 10

def feedback_artista(utente, corretto):
    # Nome
    nome_feedback = ""
    if utente.get("nome", "").lower() == corretto.get("nome", "").lower():
        nome_feedback = "Esatto!"
    elif utente.get("nome", "").lower() in corretto.get("nome", "").lower() \
         or corretto.get("nome", "").lower() in utente.get("nome", "").lower():
        nome_feedback = "Quasi, ci sei andato vicino!"
    else:
        nome_feedback = "Nessuna corrispondenza."
    
    # Anno debutto
    anno_feedback = ""
    if "debutto" in utente and "debutto" in corretto:
        try:
            delta = int(utente["debutto"]) - int(corretto["debutto"])
            if delta == 0:
                anno_feedback = "L'ANNO E' GIUSTO!"
            elif -10 <= delta < 0:
                anno_feedback = "CI SEI QUASI! UN PO' PIU' RECENTE!"
            elif 0 < delta <= 10:
                anno_feedback = "DAI, QUASI! E' UN PO' MENO RECENTE :/"
        except ValueError:
            pass
    
    # Regione
    regione_feedback = ""
    if utente.get("regione", "").lower() == corretto.get("regione", "").lower():
        regione_feedback = "VIENE PROPRIO DA LI'"
    
    # Gender
    gender_feedback = ""
    if utente.get("gender", "").lower() == corretto.get("gender", "").lower():
        gender_feedback = "GENERE CORRETTO"
    
    # Genere musicale
    genere_feedback = ""
    if utente.get("genere", "").lower() == corretto.get("genere", "").lower():
        genere_feedback = "QUESTA SI CHE E' MUSICA"
    
    return nome_feedback, anno_feedback, regione_feedback, gender_feedback, genere_feedback

def gioca(*args, **kwargs):
    global tentativi, artista_corrente
    nome_input = Element("nome").value.strip()
    feedback_div = Element("feedback")
    
    tentativi += 1
    utente_candidato = None
    for a in artisti:
        if a.get("nome", "").lower() == nome_input.lower():
            utente_candidato = a
            break
    if not utente_candidato:
        utente_candidato = {"nome": nome_input}
    
    nome_fb, anno_fb, regione_fb, gender_fb, genere_fb = feedback_artista(utente_candidato, artista_corrente)
    
    html = f"<p><strong>Tentativo {tentativi}/{max_tentativi}</strong></p>"
    html += f"<p>Nome: {nome_fb}</p>"
    if anno_fb: html += f"<p>Debutto: {anno_fb}</p>"
    if regione_fb: html += f"<p>Regione: {regione_fb}</p>"
    if gender_fb: html += f"<p>Gender: {gender_fb}</p>"
    if genere_fb: html += f"<p>Genere: {genere_fb}</p>"
    
    if nome_fb == "Esatto!":
        html += "<p>RISPOSTA ESATTA! HAI VINTO!</p>"
        tentativi = max_tentativi
    elif tentativi >= max_tentativi:
        html += f"<p>Hai esaurito i tentativi! L'artista corretto era: {artista_corrente['nome']}</p>"
    
    feedback_div.write(html)

Element("prova-btn").element.addEventListener("click", gioca)
</py-script>

</body>
</html>
