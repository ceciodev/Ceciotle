<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CECIOTLE</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéµ</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --primary-blue: #1a4a8e;
            --bg-light-blue: #f0f7ff; /* Pi√π chiaro e pulito */
            --accent-blue: #99cbff;
            --banner-yellow: #f9e294;
            --white-glass: rgba(255, 255, 255, 0.8);
            --correct: #2ecc71;
            --wrong: #e74c3c;
            --text-dark: #2c3e50;
        }

        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: var(--bg-light-blue); 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
            color: var(--text-dark); 
        }

        /* Menu */
        .menu-btn { position: fixed; top: 15px; right: 15px; font-size: 24px; cursor: pointer; z-index: 2500; background: var(--primary-blue); color: white; padding: 12px; border-radius: 50%; line-height: 1; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .sidebar { position: fixed; top: 0; right: -300px; width: 260px; height: 100%; background: white; transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1); z-index: 2600; padding: 40px 20px; box-shadow: -5px 0 25px rgba(0,0,0,0.05); }
        .sidebar.open { right: 0; }
        .sidebar a { color: var(--text-dark); text-decoration: none; display: flex; align-items: center; margin: 10px 0; font-weight: 600; padding: 12px; border-radius: 10px; transition: 0.2s; }
        .sidebar a:hover { background: var(--bg-light-blue); color: var(--primary-blue); }

        /* Contenitore Gioco */
        .game-container { width: 90%; max-width: 600px; text-align: center; padding: 40px 0; }
        h1 { font-weight: 800; font-size: 2.5rem; letter-spacing: -1px; color: var(--primary-blue); margin-bottom: 5px; }
        .counter { font-weight: 600; font-size: 1rem; color: #7f8c8d; margin-bottom: 25px; }

        /* Input e Search */
        .search-wrapper { position: relative; margin-bottom: 20px; }
        input[type="text"] { 
            width: 100%; padding: 18px 25px; border-radius: 15px; border: 2px solid #dce6f2; 
            font-size: 1rem; box-sizing: border-box; font-family: inherit; font-weight: 500;
            transition: 0.3s; background: white;
        }
        input:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 4px rgba(26, 74, 142, 0.1); }

        .autocomplete-results {
            position: absolute; top: calc(100% + 5px); left: 0; right: 0; background: white; 
            border-radius: 12px; z-index: 2000; max-height: 220px; overflow-y: auto; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: none; border: 1px solid #eee;
        }
        .autocomplete-entry { padding: 12px 20px; cursor: pointer; text-align: left; font-size: 0.95rem; border-bottom: 1px solid #f9f9f9; }
        .autocomplete-entry:hover { background: var(--bg-light-blue); }

        /* Feedback Cards */
        .feedback-card { 
            background: white; padding: 15px; border-radius: 18px; margin-bottom: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid #edf2f7;
            animation: fadeIn 0.4s ease-out;
        }
        .feedback-card strong { display: block; margin-bottom: 10px; color: var(--primary-blue); font-weight: 700; }
        
        .feedback-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        @media (min-width: 480px) { .feedback-grid { grid-template-columns: repeat(6, 1fr); } }

        .stat-box { 
            padding: 8px 4px; border-radius: 10px; font-size: 0.65rem; font-weight: 700;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: #f8fafc; color: #64748b; border: 1px solid #e2e8f0;
        }
        .stat-box.correct { background: var(--correct); color: white; border-color: var(--correct); }
        .stat-box.wrong { background: var(--wrong); color: white; border-color: var(--wrong); }
        .stat-val { font-size: 0.7rem; margin-top: 3px; font-weight: 800; opacity: 0.9; }

        /* Bottoni */
        .btn-main { 
            background: var(--primary-blue); color: white; padding: 16px; border-radius: 12px; 
            width: 100%; font-size: 1rem; cursor: pointer; border: none; font-weight: 600; 
            transition: 0.2s;
        }
        .btn-main:hover { opacity: 0.9; transform: translateY(-1px); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="menu-btn" onclick="toggleSidebar()">‚ò∞</div>

    <nav id="sidebar" class="sidebar">
        <h3 style="margin-top:0">Opzioni</h3>
        <a href="/restart"><i class="fas fa-redo"></i> Nuova Partita</a>
        <a href="#" onclick="showRules(); toggleSidebar(); return false;"><i class="fas fa-book"></i> Regole</a>
        <hr style="border:0; border-top:1px solid #eee; margin: 20px 0;">
        <a href="https://github.com/ceciodev" target="_blank"><i class="fa-brands fa-github"></i> GitHub</a>
    </nav>

    <main class="game-container" id="main-content">
        <h1>CECIOTLE</h1>
        <div class="counter">Tentativo {{ tentativi }} di 10</div>

        {% if fine_giochi %}
            <div class="feedback-card" style="padding: 30px; border: 2px solid var(--primary-blue);">
                <h2 style="color: {{ 'var(--correct)' if vittoria else 'var(--wrong)' }}; margin-top:0;">
                    {{ 'OTTIMO LAVORO! üèÜ' if vittoria else 'PECCATO... üíÄ' }}
                </h2>
                <p>L'artista era: <br><strong style="font-size: 1.5rem;">{{ target.nome }}</strong></p>
                <button class="btn-main" onclick="window.location.href='/restart'">GIOCA ANCORA</button>
            </div>
        {% else %}
            <form method="POST" id="game-form">
                <div class="search-wrapper">
                    <input type="text" name="nome" id="scelta-artista" placeholder="Chi √® l'artista di oggi?" autocomplete="off">
                    <div id="results-box" class="autocomplete-results"></div>
                </div>
                <button type="submit" class="btn-main">CONFERMA</button>
            </form>
        {% endif %}

        <div style="margin-top: 30px;">
            {% for t in cronologia %}
            <div class="feedback-card">
                <strong>{{ t.nome }}</strong>
                <div class="feedback-grid">
                    <div class="stat-box {{ 'correct' if t.feedback.gender[0] == 'CORRETTO' else 'wrong' }}">
                        <span>SESSO</span>
                        <span class="stat-val">{{ t.feedback.gender[1] }} {{ t.feedback.gender[2] }}</span>
                    </div>
                    <div class="stat-box {{ 'correct' if t.feedback.genere[0] == 'CORRETTO' else 'wrong' }}">
                        <span>GENERE</span>
                        <span class="stat-val">{{ t.feedback.genere[1] }}</span>
                    </div>
                    <div class="stat-box {{ 'correct' if t.feedback.debutto[0] == 'CORRETTO' else 'wrong' }}">
                        <span>ANNO</span>
                        <span class="stat-val">{{ t.feedback.debutto[1] }} {{ t.feedback.debutto[2] }}</span>
                    </div>
                    <div class="stat-box {{ 'correct' if t.feedback.regione[0] == 'CORRETTO' else 'wrong' }}">
                        <span>REGIONE</span>
                        <span class="stat-val">{{ t.feedback.regione[1] }}</span>
                    </div>
                    <div class="stat-box {{ 'correct' if t.feedback.componenti[0] == 'CORRETTO' else 'wrong' }}">
                        <span>MEMBRI</span>
                        <span class="stat-val">{{ t.feedback.componenti[1] }} {{ t.feedback.componenti[2] }}</span>
                    </div>
                    <div class="stat-box {{ 'correct' if t.feedback.popolarita[0] == 'CORRETTO' else 'wrong' }}">
                        <span>POP.</span>
                        <span class="stat-val">{{ t.feedback.popolarita[1] }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

    <script>
        const artisti = {{ artisti_nomi|tojson|safe }};
        const input = document.getElementById('scelta-artista');
        const resultsBox = document.getElementById('results-box');

        if (input) {
            input.addEventListener('input', function() {
                const val = this.value.toLowerCase().trim();
                resultsBox.innerHTML = '';
                if (val.length < 2) { resultsBox.style.display = 'none'; return; }
                
                const matches = artisti.filter(n => n.toLowerCase().includes(val)).slice(0, 5);
                if (matches.length > 0) {
                    matches.forEach(m => {
                        const d = document.createElement('div');
                        d.className = 'autocomplete-entry';
                        d.textContent = m;
                        d.onmousedown = () => { input.value = m; document.getElementById('game-form').submit(); };
                        resultsBox.appendChild(d);
                    });
                    resultsBox.style.display = 'block';
                } else { resultsBox.style.display = 'none'; }
            });
            input.onblur = () => setTimeout(() => resultsBox.style.display = 'none', 200);
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        
        {% if vittoria %}
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#1a4a8e', '#2ecc71', '#ffffff'] });
        {% endif %}
    </script>
</body>
</html>
